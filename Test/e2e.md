# E2E(End to End) testing について

E2E テストは、一般的に **プリケーションが期待どおりに動作し、ユーザーのタスクやプロセスの種類を問わずデータフローが適切に機能すること** をテストするものと表現されています。

## 全てのユースケースに E2E テストを書けば良いのか

E2E のメリットには下記のようなものがあり **『全てのユースケースを書くこと』が理想系のように錯覚** してしまいます。

- テスト範囲を拡大(カバレッジの改善)
  - 単体/結合テストで発見できないバグを感知できる
- リリースまでの時間を短縮(QC 工数の削減など)
  - コスト削減

一方でユースケースを全てテストしようとする場合、`The Ice Cream Cone`と呼ばれるアンチパターンが潜んでいます。

**図左: `The Ice Cream Cone`, 図右: `正常なピラミッド状態`**

![ice_cream_cone](https://user-images.githubusercontent.com/46220963/184571054-a3136f0c-fc61-4dd9-8ccf-0bf02d936dc7.png)

`The Ice Cream Cone`はユニット/インテグレーションテストでカバーできるような項目を E2E テストでカバーしているよう状態で、下記のようなデメリットを誘発します。

- テスト実行時間が長くなる
- 実装/保守コストが大きくなる

従って、重要なポイントは
<br/>**E2E テストは、ユニット（単体）テスト、インテグレーション（結合）テストで賄えない部分をテストするもの。**<br/>
という意識を持つことです。

できるだけ、E2E テストではなくユニット/インテグレーションテストでカバーできないかを考え、テストは並列実行することで実行時間を短くできるように努めることが大切だと考えます。

<br/>

## 「実装/保守コスト」

E2E における実装/保守コストを 1(低コスト)~3(高コスト)で分別しました。

- テストしたい状態まで操作する難易度と、その保守する難易度
  - **[1]** HTML の属性などで操作可能なもの
  - **[2]** 1 に加えて、テスト用のデータ準備(Live 中の番組など)が必要なもの
  - **[3]** テスト環境に「実機」や「テスト環境を提供するサービス」が必要なもの
- 期待値の内容 (どうなればテストパスするのか)
  - **[1]** HTML の属性や値の状態を期待値におく場合
  - **[2]** 結果の SS を比較する場合
  - **[3]** 映像の MOS(※備考)など個別指標があり、測定に専用のシステムなどを用意する場合

今回の実装ではどちらか一方でも 3 に該当するものは、コストが大きいため基本的に除外します。

